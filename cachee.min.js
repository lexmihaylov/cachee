!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.cachee=t()}(this,function(){var e={},t={cache:function(e){return Promise.all(e)},load:function(e){e=e||document,this._parseDom(e)},_cacheTable:function(){return e}};t.request=function(e){var t=new XMLHttpRequest,r=new Promise(function(e,r){t.addEventListener("load",function n(){200===t.status?e(t):r(new Error("Failed to load: "+t.status+" ("+t.statusText+")")),t.removeEventListener("load",n)})});if(e.method=e.method||"GET","POST"===e.method.toUpperCase()&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.responseType=e.responseType||"blob",e.timeout&&(t.timeout=e.timeout),e.overrideMimeType&&e.overrideMimeType(e.overrideMimeType),e.headers)for(var n in e.headers)t.setRequestHeader(n,e.headers[n]);if(e.listeners){var o=function(e,r){t.addEventListener(e,function(){r.apply(null,arguments)})};for(var i in e.listeners)o(i,e.listeners[i])}return t.open(e.method.toUpperCase(),e.url,!("async"in e)||e.async),t.send(e.data||null),r},t.resource=function(t,r){var n={},o=new Promise(function(e,t){n.resolve=e,n.reject=t});return t in e?(n.resolve(e[t]),o):(r=r||{},r.url=t,r.responseType="blob",r.method=r.method||"GET",this.request(r).then(function(t){e[r.url]=window.URL.createObjectURL(t.response),n.resolve(e[r.url])}).catch(function(e){n.reject(e)}),o)},t.readResource=function(e,t){t=t||"text";var r={},n=new Promise(function(e,t){r.resolve=e,r.reject=t});return this.resource(e).then(function(n){return n?this.request({url:n,responseType:t}):void r.reject(new Error("cant load resource `"+e+"`"))}.bind(this)).then(function(e){r.resolve(e.response)}).catch(r.reject),n},t.writeResource=function(t,r,n){return n=n||"text/plain",new Promise(function(o){e[t]=window.URL.createObjectURL(new Blob([r],{type:n})),o(e[t])})};var r=function(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")};return t.$$=function(e,t){return Array.prototype.slice.call(e.querySelectorAll(t))},t._parseDom=function(e){var n=function(){var n=t.$$(e,"[cachee]");n.forEach(function(e){var t=e.getAttribute("cachee"),n=e.getAttribute("cachee-tpl"),o=t.substring(0,t.indexOf(":")),i=o.split("."),s=t.substring(t.indexOf(":")+1);this.resource(s).then(function(t){for(var s=e,c=0;c<i.length-1;c++)s=s[i[c]];n&&(t=n.replace(new RegExp("\\$\\{"+r(o)+"\\}","g"),t)),s[i[i.length-1]]=t,e.removeAttribute("cachee")})}.bind(this))}.bind(this);n()},t});
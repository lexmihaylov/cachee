!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.cachee=t()}(this,function(){var e={},t={cache:function(e){return Promise.all(e)},load:function(e){e=e||document,this._parseDom(e)},_cacheTable:function(){return e}};t.request=function(e){var t=new XMLHttpRequest,n=new Promise(function(e,n){t.addEventListener("load",function r(){200===t.status?e(t):n(new Error("Failed to load: "+t.status+" ("+t.statusText+")")),t.removeEventListener("load",r)})});if(e.method=e.method||"GET","POST"===e.method.toUpperCase()&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.responseType=e.responseType||"blob",e.timeout&&(t.timeout=e.timeout),e.overrideMimeType&&e.overrideMimeType(e.overrideMimeType),e.headers)for(var r in e.headers)t.setRequestHeader(r,e.headers[r]);if(e.listeners){var o=function(e,n){t.addEventListener(e,function(){n.apply(null,arguments)})};for(var i in e.listeners)o(i,e.listeners[i])}return t.open(e.method.toUpperCase(),e.url,!("async"in e)||e.async),t.send(e.data||null),n},t.resource=function(t,n){var r={},o=new Promise(function(e,t){r.resolve=e,r.reject=t});return t in e?(r.resolve(e[t]),o):(n=n||{},n.url=t,n.responseType="blob",n.method=n.method||"GET",this.request(n).then(function(t){e[n.url]=window.URL.createObjectURL(t.response),r.resolve(e[n.url])}).catch(function(e){r.reject(e)}),o)},t.readResource=function(e,t){t=t||"text";var n={},r=new Promise(function(e,t){n.resolve=e,n.reject=t});return this.resource(e).then(function(r){return r?this.request({url:r,responseType:t}):void n.reject(new Error("cant load resource `"+e+"`"))}.bind(this)).then(function(e){n.resolve(e.response)}).catch(n.reject),r},t.writeResource=function(t,n,r){return r=r||"text/plain",new Promise(function(o){e[t]=window.URL.createObjectURL(new Blob([n],{type:r})),o(e[t])})},t.deleteResource=function(t){if(t in e){var n=e[t];delete e[t],window.URL.revokeObjectURL(n)}};var n=function(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")};return t.$$=function(e,t){return Array.prototype.slice.call(e.querySelectorAll(t))},t._parseDom=function(e){var r=function(){var r=t.$$(e,"[cachee]");r.forEach(function(e){var t=e.getAttribute("cachee"),r=e.getAttribute("cachee-tpl"),o=t.substring(0,t.indexOf(":")),i=o.split("."),s=t.substring(t.indexOf(":")+1);this.resource(s).then(function(t){for(var s=e,c=0;c<i.length-1;c++)s=s[i[c]];r&&(t=r.replace(new RegExp("\\$\\{"+n(o)+"\\}","g"),t)),s[i[i.length-1]]=t,e.removeAttribute("cachee")})}.bind(this))}.bind(this);r()},t});
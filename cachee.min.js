!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.cachee=t()}(this,function(){var e={},t={cache:function(e){return Promise.all(e)},load:function(e){e=e||document,this._parseDom(e)},_cacheTable:function(){return e}};return t.request=function(e){var t=new XMLHttpRequest,n=new Promise(function(e,n){t.addEventListener("load",function r(){200===t.status?e(t):n(new Error(t.status+" ("+t.statusText+")")),t.removeEventListener("load",r)})});if(e.method=e.method||"GET","POST"===e.method.toUpperCase()&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.responseType=e.responseType||"blob",e.timeout&&(t.timeout=e.timeout),e.overrideMimeType&&e.overrideMimeType(e.overrideMimeType),e.headers)for(var r in e.headers)t.setRequestHeader(r,e.headers[r]);if(e.listeners){var o=function(e,n){t.addEventListener(e,function(){n.apply(null,arguments)})};for(var i in e.listeners)o(i,e.listeners[i])}return t.open(e.method.toUpperCase(),e.url),t.send(e.data||null),n},t.resource=function(t,n){var r={},o=new Promise(function(e,t){r.resolve=e,r.reject=t});return t in e?(r.resolve(e[t]),o):(n=n||{},n.url=t,n.responseType="blob",n.method=n.method||"GET",this.request(n).then(function(t){e[n.url]=window.URL.createObjectURL(t.response),r.resolve(e[n.url])}).catch(function(e){console.warn(e),r.resolve(null)}),o)},t.readResource=function(e,t){t=t||"text";var n={},r=new Promise(function(e,t){n.resolve=e,n.reject=t});return this.resource(e).then(function(r){return r?this.request({url:e,responseType:t}):void n.reject(new Error("cant load resource `"+e+"`"))}.bind(this)).then(function(e){n.resolve(e.response)}),r},t.$$=function(e,t){return Array.prototype.slice.call(e.querySelectorAll(t))},t._parseDom=function(e){var n=function(){var n=t.$$(e,"[cachee]");n.forEach(function(e){var t=e.getAttribute("cachee"),n=t.substring(0,t.indexOf(":")),r=t.substring(t.indexOf(":")+1);this.resource(r).then(function(t){e[n]=t,e.removeAttribute("cachee")})}.bind(this))}.bind(this);"complete"==document.readyState||"loaded"==document.readyState?n():document.addEventListener("DOMContentLoaded",function(){n()},!1)},t});